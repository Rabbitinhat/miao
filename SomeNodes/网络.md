# 网络Q&A

## 基础

---

### 网络的结构特点?

网状, 分层结构

### 网络的5层结构是什么?

物理层
- 电信号传输
链路层
- 两台直接链接的计算机之间进行的数据(数据包)交换
网络层
- 非直接链接的计算机传输的数据基于链路层的中转
- 提供双边单向通信
传输层
- 提供双边双向通信
- UDP
- TCP
应用层
- 基于传输层的协议传输特定类型数据

## 物理层

---

网络时间同步

使用曼彻斯特编码, 跳变?

[计算机网络时间同步技术原理介绍](https://segmentfault.com/a/1190000005337116)

随着跳变次数的增加, 单位传输的信息量会减少

## 链路层

---

### 什么是链路层

由集线器和交换机直接连接的计算机进行数据传输的位置

### 多个计算机相互通信的链接方式

- 两两连接, 令牌环方式
- 总线型结构, 多个机器连接到同一总线上, 通过MAC(网卡)地址标记发送者
    + MAC Media Access Control 媒介访问控制
    + 网线通过集线器进行连接
    + 集线器
      + 总线结构, 连接多条网线
      + 结构简单
    + 判断同一时间是否有其他设备发送数据? 使用载波侦听进行判断, 使用指数退避(每次等待时间指数增长)来延迟发送, 同一时间只能有一个设备进行发送
      + 载波侦听
      + 多路访问
    + 发送数据为以太网帧格式 [以太网帧](https://zh.wikipedia.org/wiki/%E4%BB%A5%E5%A4%AA%E7%BD%91%E5%B8%A7%E6%A0%BC%E5%BC%8F)
        * 查看MAC地址
        * ipconfig(ifconfig Mac/Linux) 查看网卡信息, 物理地址信息
          * install net-tools
    + 交换机
        + 使用集线器时, 多个设备同时发送信息时, 需要等待和侦听, 使得效率并不高
        * 自动读取计算机的MAC地址, 同一时间可以有多个设备进行发送
          * 能够正确识别数据包的目的地址, 自动进行转发
        * [交换机](https://zh.wikipedia.org/wiki/%E7%B6%B2%E8%B7%AF%E4%BA%A4%E6%8F%9B%E5%99%A8)
    + 以太网
        * 通过网线进行连接的网络
        * 最底层部分
        * `10.1.1.1`
        * 典型的链路层设备
    + 使用IP地址获取发送目的的MAC地址
        * 使用ARP协议获取MAC地址
            * `arp -a`
            * Address Resolution Protocol 地址解析协议
            - 使用ARP缓存表-保存(IP地址和对应的MAC地址)或发送广播
            - [地址解析协议](https://zh.wikipedia.org/wiki/%E5%9C%B0%E5%9D%80%E8%A7%A3%E6%9E%90%E5%8D%8F%E8%AE%AE)
        * 使用wireshark进行抓包 [过滤器使用](https://www.jianshu.com/p/a97a23abd577)
        * 广播风暴-大量arp广播
            - 网管交换机(可以设置端口连接的计算机的具体ip的MAC地址)
        * ARP欺骗
        * ping地址
            - 局域网中, 可以任意设置IP地址
            - 网关
              - 局域网出口, 当局域网内机器需要访问外部网络的机器时, 需要经过网关
            - 子网掩码 255.255.255.0(11111111.11111111.11111111.00000000)
                + 左边特定位数为1, 右边为0
                + 通过分别将发送主机IP, 目的主机IP与掩码进行`&`操作(保留左边位数), 根据得出的结果数据是否相同来判断两者是否位于同一局域网内(网络号相同)
                + [如何理解子网掩码](https://www.zhihu.com/question/56895036)

## 网络层

家用路由器是网关和交换机的集合 

- 当目标IP不存在域局域网中(IP地址和子网掩码的`&`操作结果不同), 就会通过网关(路由器)和外部网络进行通信
- 网关也要和机器位于同一局域网
- 路由器的目的是连接不同的子网
  - 连接不同端口的不同子网和该端口位于同一局域网(网关)
  - 不同子网有单独的对外的IP地址
  - 拥有路由表, 记录不同端口连接的子网
- 家用路由器
  - NAT路由器
  - 包含一个交换机和路由器
  - 连接网线的端口拥有一个广域网IP地址
  - 路由器内部包含一个IP地址(192.168.1.1)
- IP层数据包, **IP包头**
  - 位于以太网帧的负载中
  - IP分片和IP重组
  - **TTL** 生成时间, IP中转次数, 为0时, 停止转发. TTL超时
  - 协议
    - 标识携带数据格式
  - 非直接连接的机器发送数据时, IP数据包会在两台机器之间的所有机器之间进行中转(作为以太网帧)
  - tracert 用于追踪发送机器和目的机器中的节点
    - 发送TTL递增的IP数据包, h利用TTL超时时, 数据包所在机器会向源机器发送数据
    - ICMP 格式, 传递网络消息